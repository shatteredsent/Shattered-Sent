<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shattered & Sent | Healing Through Redemption</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts - Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f8fafc;
      scroll-behavior: smooth;
      color: #1e293b;
    }
    header {
      background: white;
      box-shadow: 0 4px 6px rgb(0 0 0 / 0.1);
      position: sticky;
      top: 0;
      z-index: 50;
      border-bottom-left-radius: 1rem;
      border-bottom-right-radius: 1rem;
    }
    nav ul {
      display: flex;
      gap: 2rem;
      list-style: none;
      padding: 0;
      margin: 0;
    }
    nav a {
      color: #334155;
      font-weight: 500;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    nav a:hover {
      color: #6366f1;
    }
    main {
      max-width: 1200px;
      margin: 3rem auto;
      padding: 0 1.5rem;
    }
    section {
      margin-bottom: 4rem;
    }
    h2 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #4f46e5;
      margin-bottom: 2rem;
      text-align: center;
    }
    /* Video container responsive */
    .video-wrapper {
      position: relative;
      padding-bottom: 56.25%; /* 16:9 */
      height: 0;
      overflow: hidden;
      max-width: 100%;
      margin: 0 auto 2rem;
      border-radius: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .video-wrapper iframe {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      border: none;
      border-radius: 1rem;
    }
    /* Subscribe button */
    .subscribe-btn {
      display: block;
      text-align: center;
      margin-bottom: 3rem;
    }
    .subscribe-btn .g-ytsubscribe {
      display: inline-block;
    }
    /* Back to Top Button */
    #backToTopBtn {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 99;
      background-color: #4f46e5;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transition: background-color 0.3s, transform 0.3s;
    }
    #backToTopBtn:hover {
      background-color: #4338ca;
      transform: translateY(-3px);
    }
    /* Pulse animation */
    @keyframes pulse-once {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    .animate-pulse-once:hover {
      animation: pulse-once 0.5s ease-in-out;
    }
    /* Styles for the logo in the header - ADJUSTED MAX-WIDTHS HERE */
    .header-logo-container {
        max-width: 150px; /* Smaller default max width */
        height: auto;
    }
    .header-logo-container img {
        width: 100%;
        height: auto;
        border-radius: 0.5rem; /* Match other rounded elements */
    }
    /* Responsive adjustments for header logo */
    @media (min-width: 640px) { /* sm breakpoint */
        .header-logo-container {
            max-width: 180px; /* Smaller max width on small screens and up */
        }
    }
    @media (min-width: 768px) { /* md breakpoint */
        .header-logo-container {
            max-width: 220px; /* Smaller max width on medium screens and up */
        }
    }

    /* Message Box Styles (for contact form and video error) */
    .message-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 2rem;
        border-radius: 0.75rem;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        text-align: center;
        display: none; /* Hidden by default */
        max-width: 90%;
        width: 400px;
    }
    .message-box.show {
        display: block;
    }
    .message-box h3 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #4f46e5;
    }
    .message-box p {
        margin-bottom: 1.5rem;
        color: #475569;
    }
    .message-box button {
        background-color: #4f46e5;
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .message-box button:hover {
        background-color: #4338ca;
    }
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none; /* Hidden by default */
    }
    .overlay.show {
        display: block;
    }

    /* Blog Post Specific Styles */
    .blog-post-card {
        background-color: white;
        padding: 2rem;
        border-radius: 0.75rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        margin-bottom: 2rem;
    }
    .blog-post-card h3 { /* Changed from h2 to h3 for semantic hierarchy */
        font-size: 1.75rem; /* Slightly smaller than section h2 */
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 0.5rem;
    }
    .blog-post-card .meta {
        font-size: 0.9rem;
        color: #64748b; /* Slate-500 */
        margin-bottom: 1rem;
    }
    .blog-post-card p {
        margin-bottom: 1rem;
    }
    .read-more-btn {
        color: #4f46e5;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
        cursor: pointer; /* Indicate it's clickable */
    }
    .read-more-btn:hover {
        color: #3730a3; /* Indigo-800 */
    }

    /* Modal for Full Blog Post */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1001; /* Above message box */
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .modal.show {
        opacity: 1;
        visibility: visible;
    }
    .modal-content {
        background-color: white;
        padding: 2rem;
        border-radius: 0.75rem;
        max-width: 800px;
        max-height: 90vh; /* Limit height to prevent overflow */
        overflow-y: auto; /* Enable scrolling for long content */
        position: relative;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        transform: translateY(20px);
        transition: transform 0.3s ease;
    }
    .modal.show .modal-content {
        transform: translateY(0);
    }
    .modal-close-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #64748b;
        transition: color 0.3s ease;
    }
    .modal-close-btn:hover {
        color: #1e293b;
    }
    .modal-body h2 {
        font-size: 2rem; /* Adjusted for modal content */
        text-align: left;
        margin-bottom: 1rem;
        color: #1e293b;
    }
    .modal-body p {
        margin-bottom: 1rem;
    }

  </style>
</head>
<body>
  <!-- Header with responsive flex classes -->
  <header class="flex flex-col sm:flex-row justify-between items-center py-4 px-6 sm:py-6 sm:px-12">
    <!-- Logo integrated here -->
    <!-- IMPORTANT: Ensure 'Shattered.png' is in the correct path relative to your HTML file on GitHub! -->
    <div class="header-logo-container mb-4 sm:mb-0"> <!-- Added margin-bottom for mobile -->
        <img src="Shattered.png" alt="Shattered & Sent Logo - From Brokenness to Bold Faith" class="shadow-sm rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/300x100/cccccc/333333?text=Logo+Not+Found';">
    </div>
    <nav class="mt-4 sm:mt-0"> <!-- Added margin-top for mobile -->
      <ul>
        <li><a href="#home">Home</a></li>
        <li><a href="#about">About</a></li>
        <li><a href="#content">Content</a></li>
        <li><a href="#blog-posts">Blog</a></li> <!-- NEW Blog Link -->
        <li><a href="#resources">Resources</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <!-- Home / Hero -->
    <section id="home" class="text-center mb-16">
      <h2 class="text-5xl font-extrabold text-indigo-700 mb-6">Welcome to Shattered & Sent</h2>
      <p class="max-w-xl mx-auto text-lg text-gray-600 leading-relaxed">
        From Brokenness to Bold Faith — sharing stories of redemption, healing, and God's grace.
      </p>
    </section>

    <!-- Latest Video -->
    <section id="content">
      <h2 class="text-4xl font-bold text-center text-indigo-600 mb-8">📺 Latest from My YouTube Channel</h2>
      <div class="video-wrapper" id="latestVideo">
        <div class="flex items-center justify-center h-full text-gray-500">Loading video...</div>
      </div>
      <div class="subscribe-btn">
        <!-- YouTube subscribe button -->
        <div class="g-ytsubscribe" data-channelid="UCjhAWGLaxd124jxAdD_digQ" data-layout="default" data-count="default"></div>
      </div>
    </section>

    <!-- About Section -->
    <section id="about" class="max-w-3xl mx-auto mb-16">
      <h2 class="text-4xl font-bold text-center text-indigo-600 mb-8">About Shattered & Sent</h2>
      <p class="text-gray-700 text-lg leading-relaxed text-center">
        "Shattered & Sent" is a ministry dedicated to sharing the transformative power of God's love and grace. Even in brokenness, God uses us for His glorious purposes. We provide biblical insights, testimonies, and practical wisdom to encourage believers on their spiritual journey.
      </p>
    </section>

    <!-- NEW Blog Posts Section -->
    <section id="blog-posts" class="max-w-4xl mx-auto mb-16">
        <h2 class="text-4xl font-bold text-center text-indigo-600 mb-8">📝 Our Blog</h2>
        <div id="blogPostsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Blog posts will be loaded here by JavaScript -->
            <p class="col-span-full text-center text-gray-500">Loading blog posts...</p>
        </div>
    </section>

    <!-- Resources Section -->
    <section id="resources" class="max-w-4xl mx-auto mb-16">
      <h2 class="text-4xl font-bold text-center text-indigo-600 mb-8">Featured Resources</h2>
      <ul class="list-none p-0 max-w-3xl mx-auto">
        <li class="bg-indigo-50 p-6 rounded-xl shadow-md mb-4 transition transform hover:scale-105 hover:shadow-lg">
          <strong class="text-xl text-indigo-700">E-Book: Journey Through John</strong><br/>
          <p class="text-gray-700 mt-2">A devotional guide exploring the Gospel of John, perfect for personal study or groups.</p>
        </li>
        <li class="bg-indigo-100 p-6 rounded-xl shadow-md mb-4 transition transform hover:scale-105 hover:shadow-lg">
          <strong class="text-xl text-indigo-700">Podcast: Faith in Action Series</strong><br/>
          <p class="text-gray-700 mt-2">Practical ways to live out faith daily, tackling challenges with biblical wisdom.</p>
        </li>
        <li class="bg-indigo-200 p-6 rounded-xl shadow-md transition transform hover:scale-105 hover:shadow-lg">
          <strong class="text-xl text-indigo-700">Study Guide: Overcoming Adversity</strong><br/>
          <p class="text-gray-700 mt-2">Biblical perspectives and steps for navigating life’s challenges with God's promises.</p>
        </li>
      </ul>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="max-w-3xl mx-auto mb-24">
      <h2 class="text-4xl font-bold text-center text-indigo-600 mb-8">Get in Touch</h2>
      <form id="contactForm" class="flex flex-col gap-4 bg-white p-8 rounded-xl shadow-lg">
        <input type="text" name="name" placeholder="Your Name" required
               class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200" />
        <input type="email" name="email" placeholder="Your Email" required
               class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200" />
        <textarea name="message" placeholder="Your Message" rows="6" required
                  class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200"></textarea>
        <button type="submit"
                class="bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-200">
          Send Message
        </button>
      </form>
      <p class="mt-4 text-center text-gray-600">Or email us directly at: <a href="mailto:shattered.sent@gmail.com" class="text-indigo-600 hover:underline">shattered.sent@gmail.com</a></p>
    </section>
  </main>

  <footer class="bg-gray-800 text-white py-6 text-center rounded-t-xl">
    <div class="flex justify-center items-center space-x-4 mb-4">
      <a href="https://www.youtube.com/channel/UCjhAWGLaxd124jxAdD_digQ" class="text-gray-400 hover:text-white transition duration-300" target="_blank" rel="noopener noreferrer">
        <i class="fab fa-youtube text-2xl"></i> <span class="sr-only">YouTube</span>
      </a>
      <!-- Add other social media links if desired -->
    </div>
    <p class="text-gray-400">&copy; 2025 Shattered & Sent. All rights reserved.</p>
  </footer>

  <!-- Back to Top Button -->
  <button id="backToTopBtn" title="Go to top" class="rounded-full shadow-lg hover:shadow-xl">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- Message Box HTML -->
  <div id="messageBox" class="message-box">
      <h3 id="messageBoxTitle"></h3>
      <p id="messageBoxContent"></p>
      <button onclick="hideMessageBox()">OK</button>
  </div>
  <div id="overlay" class="overlay" onclick="hideMessageBox()"></div>

  <!-- Modal for Full Blog Post Content -->
  <div id="blogPostModal" class="modal">
      <div class="modal-content">
          <button class="modal-close-btn" onclick="hideBlogPostModal()">&times;</button>
          <div id="modalBlogPostContent" class="modal-body">
              <!-- Full blog post content will be loaded here -->
          </div>
      </div>
  </div>

  <!-- Load YouTube Subscribe Button script -->
  <script src="https://apis.google.com/js/platform.js"></script>

  <script>
    // Function to show custom message box
    function showMessageBox(title, message) {
        document.getElementById('messageBoxTitle').innerText = title;
        document.getElementById('messageBoxContent').innerText = message;
        document.getElementById('messageBox').classList.add('show');
        document.getElementById('overlay').classList.add('show');
    }

    // Function to hide custom message box
    function hideMessageBox() {
        document.getElementById('messageBox').classList.remove('show');
        document.getElementById('overlay').classList.remove('show');
    }

    // Functions for Blog Post Modal
    function showBlogPostModal() {
        document.getElementById('blogPostModal').classList.add('show');
        document.body.style.overflow = 'hidden'; // Prevent scrolling background
    }

    function hideBlogPostModal() {
        document.getElementById('blogPostModal').classList.remove('show');
        document.body.style.overflow = ''; // Restore scrolling
        document.getElementById('modalBlogPostContent').innerHTML = ''; // Clear content
    }


    // Base URL for your backend (assuming it's running locally on port 5000)
    const BACKEND_URL = 'https://jshafer2017.pythonanywhere.com'; // Replace 'jshafer2017' with your actual PythonAnywhere username

    // --- Latest Video fetch from Backend ---
    document.addEventListener('DOMContentLoaded', () => {
        fetch(`${BACKEND_URL}/api/latest-video`)
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                if (data.videoId) {
                    const embedHtml = `
                        <iframe
                            src="https://www.youtube.com/embed/${data.videoId}"
                            title="Latest YouTube Video"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                        ></iframe>`;
                    document.getElementById('latestVideo').innerHTML = embedHtml;
                } else {
                    document.getElementById('latestVideo').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">No videos found.</div>';
                }
            })
            .catch(err => {
                console.error('Error fetching latest video:', err);
                document.getElementById('latestVideo').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">Failed to load video. Please try again later.</div>';
                showMessageBox('Video Error', 'Could not load the latest YouTube video. Please check your internet connection or try again later.');
            });

        // --- Fetch Blog Posts on Load ---
        fetchBlogPosts();
    });

    async function fetchBlogPosts() {
        const blogPostsContainer = document.getElementById('blogPostsContainer');
        blogPostsContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">Loading blog posts...</p>'; // Show loading message

        try {
            const response = await fetch(`${BACKEND_URL}/api/blog-posts`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const posts = await response.json();

            if (posts.length > 0) {
                blogPostsContainer.innerHTML = ''; // Clear loading message
                posts.forEach(post => {
                    const postCard = document.createElement('div');
                    postCard.classList.add('blog-post-card', 'col-span-1', 'flex', 'flex-col');
                    postCard.innerHTML = `
                        <h3 class="text-xl font-bold text-gray-800">${post.title}</h3>
                        <p class="meta">Published on ${post.publish_date} by ${post.author}</p>
                        <p class="flex-grow">${post.excerpt}</p>
                        <a href="#" class="read-more-btn mt-auto" data-post-id="${post.id}">Read More &rarr;</a>
                    `;
                    blogPostsContainer.appendChild(postCard);
                });

                // Add event listeners to "Read More" buttons
                document.querySelectorAll('.read-more-btn').forEach(button => {
                    button.addEventListener('click', async (event) => {
                        event.preventDefault();
                        const postId = event.target.dataset.postId;
                        await fetchSingleBlogPost(postId);
                    });
                });

            } else {
                blogPostsContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">No blog posts found.</p>';
            }

        } catch (error) {
            console.error('Error fetching blog posts:', error);
            blogPostsContainer.innerHTML = '<p class="col-span-full text-center text-red-500">Failed to load blog posts. Please try again later.</p>';
            showMessageBox('Blog Error', 'Could not load blog posts. Please check your internet connection or try again later.');
        }
    }

    async function fetchSingleBlogPost(postId) {
        const modalContentDiv = document.getElementById('modalBlogPostContent');
        modalContentDiv.innerHTML = '<p class="text-center text-gray-500">Loading post...</p>';
        showBlogPostModal(); // Show modal with loading message

        try {
            const response = await fetch(`${BACKEND_URL}/api/blog-posts/${postId}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const post = await response.json();

            if (post) {
                modalContentDiv.innerHTML = `
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">${post.title}</h2>
                    <p class="text-gray-600 text-sm mb-4">By ${post.author} on ${post.publish_date}</p>
                    <div class="prose max-w-none">${post.content}</div> <!-- Use prose class for basic markdown styling if needed -->
                `;
            } else {
                modalContentDiv.innerHTML = '<p class="text-center text-red-500">Blog post not found.</p>';
            }
        } catch (error) {
            console.error('Error fetching single blog post:', error);
            showMessageBox('Error', 'Could not load blog post details. Please try again.');
        }
    }

    // --- Contact Form Submission (Existing) ---
    document.getElementById('contactForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData(this);
        const data = {};
        formData.forEach((value, key) => {
            data[key] = value;
        });

        fetch(`${BACKEND_URL}/api/contact`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(res => {
            if (!res.ok) {
                return res.json().then(errData => { throw new Error(errData.error || 'Unknown error occurred.'); });
            }
            return res.json();
        })
        .then(result => {
            showMessageBox('Success!', result.message);
            this.reset();
        })
        .catch(error => {
            console.error('Error submitting form:', error);
            showMessageBox('Submission Failed', error.message || 'There was an issue sending your message. Please try again.');
        });
    });

    // --- Back to Top Button functionality (Existing) ---
    const backToTopBtn = document.getElementById('backToTopBtn');

    window.addEventListener('scroll', () => {
      if(window.scrollY > 100) {
        if(backToTopBtn.style.display !== 'flex') {
          backToTopBtn.style.display = 'flex';
          backToTopBtn.classList.add('animate-pulse-once');
          setTimeout(() => backToTopBtn.classList.remove('animate-pulse-once'), 500);
        }
      } else {
        backToTopBtn.style.display = 'none';
      }
    });

    backToTopBtn.addEventListener('click', () => {
      window.scrollTo({top: 0, behavior: 'smooth'});
    });
  </script>
</body>
</html>
