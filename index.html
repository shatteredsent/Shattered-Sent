<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shattered & Sent</title>
    <meta name="description" content="From Brokenness to Bold Faith — sharing stories of redemption, healing, and God's grace.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.15);
        }
        
        .youtube-embed {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.2);
        }
        
        .youtube-embed iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .loading-spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.3);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
    </style>
</head>
<body class="text-gray-800">
    <div id="notification" class="notification"></div>

    <header class="glass-effect py-4 px-6 md:px-12">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
            <div class="text-3xl font-bold text-indigo-700 mb-4 md:mb-0">Shattered & Sent</div>
            <nav>
                <ul class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-8">
                    <li><a href="#home" class="text-lg text-gray-700 hover:text-indigo-600 font-medium transition duration-300">Home</a></li>
                    <li><a href="#about" class="text-lg text-gray-700 hover:text-indigo-600 font-medium transition duration-300">About</a></li>
                    <li><a href="#content" class="text-lg text-gray-700 hover:text-indigo-600 font-medium transition duration-300">Content</a></li>
                    <li><a href="#contact" class="text-lg text-gray-700 hover:text-indigo-600 font-medium transition duration-300">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section id="home" class="gradient-bg text-white py-20 px-6 md:px-12 text-center">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl md:text-6xl font-bold leading-tight mb-6">
                Transformed by Grace, Empowered for Purpose
            </h1>
            <p class="text-xl md:text-2xl mb-8 opacity-90">
                From Brokenness to Bold Faith — sharing stories of redemption, healing, and God's grace.
            </p>
        </div>
    </section>

    <section id="content" class="py-16 px-6 md:px-12">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-indigo-700 mb-4">Latest from My YouTube Channel</h2>
            </div>
            
            <div id="youtube-container" class="max-w-4xl mx-auto mb-16">
                <div id="youtube-loading" class="flex justify-center items-center py-16">
                    <div class="loading-spinner"></div>
                    <span class="ml-3 text-gray-600">Loading video...</span>
                </div>
                <div id="youtube-video" class="youtube-embed hidden"></div>
                <div id="youtube-error" class="text-center py-12 hidden">
                    <p class="text-gray-600">Unable to load the latest video at this time.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="about" class="py-16 px-6 md:px-12 bg-white">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-indigo-700 mb-8">About Shattered & Sent</h2>
            <p class="text-lg text-gray-700 mb-6 leading-relaxed">
                "Shattered & Sent" is a ministry dedicated to sharing the transformative power of God's love and grace. Even in brokenness, God uses us for His glorious purposes. We provide biblical insights, testimonies, and practical wisdom to encourage believers on their spiritual journey.
            </p>
        </div>
    </section>

    <section class="py-16 px-6 md:px-12 bg-gray-50">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-12">
                <h2 id="blog-title" class="text-3xl md:text-4xl font-bold text-indigo-700 mb-8">Loading blog posts...</h2>
            </div>
            
            <div id="blog-container" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white rounded-xl shadow-md overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="animate-pulse">
                            <div class="h-4 bg-gray-300 rounded w-3/4 mb-3"></div>
                            <div class="h-3 bg-gray-300 rounded w-full mb-2"></div>
                            <div class="h-3 bg-gray-300 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="animate-pulse">
                            <div class="h-4 bg-gray-300 rounded w-3/4 mb-3"></div>
                            <div class="h-3 bg-gray-300 rounded w-full mb-2"></div>
                            <div class="h-3 bg-gray-300 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="animate-pulse">
                            <div class="h-4 bg-gray-300 rounded w-3/4 mb-3"></div>
                            <div class="h-3 bg-gray-300 rounded w-full mb-2"></div>
                            <div class="h-3 bg-gray-300 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="py-16 px-6 md:px-12 bg-white">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-indigo-700 mb-6">Get in Touch</h2>
            </div>
            
            <div class="max-w-2xl mx-auto">
                <form id="contact-form" class="space-y-6">
                    <div>
                        <label for="name" class="block text-lg font-medium text-gray-700 mb-2">Name</label>
                        <input type="text" id="name" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" placeholder="Your Name">
                    </div>
                    <div>
                        <label for="email" class="block text-lg font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" placeholder="you@example.com">
                    </div>
                    <div>
                        <label for="message" class="block text-lg font-medium text-gray-700 mb-2">Message</label>
                        <textarea id="message" name="message" rows="6" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" placeholder="Your message..."></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" id="submit-btn" class="bg-indigo-600 text-white hover:bg-indigo-700 px-8 py-4 rounded-full text-lg font-semibold shadow-lg transition duration-300 disabled:opacity-50">
                            <span id="submit-text">Send Message</span>
                            <div id="submit-spinner" class="loading-spinner mx-auto hidden" style="width: 1.25rem; height: 1.25rem;"></div>
                        </button>
                    </div>
                </form>
                
                <div class="mt-12 text-center text-gray-600">
                    <p class="mb-2">Or email us directly at:</p>
                    <p class="text-xl font-semibold text-indigo-700">
                        <a href="mailto:shattered.sent@gmail.com">shattered.sent@gmail.com</a>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-gray-800 text-white py-8 px-6 md:px-12 text-center">
        <p class="text-gray-400">&copy; 2025 Shattered & Sent. All rights reserved.</p>
    </footer>

    <script>
        // Configuration - Update this to match your deployed backend URL
        const API_BASE_URL = 'https://jshafer2017.pythonanywhere.com';

        // Show notifications
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Load latest YouTube video
        async function loadLatestVideo() {
            const loadingEl = document.getElementById('youtube-loading');
            const videoEl = document.getElementById('youtube-video');
            const errorEl = document.getElementById('youtube-error');

            try {
                const response = await fetch(`${API_BASE_URL}/api/latest-video`);
                const data = await response.json();

                if (response.ok && data.videoId) {
                    loadingEl.classList.add('hidden');
                    videoEl.innerHTML = `
                        <iframe 
                            src="https://www.youtube.com/embed/${data.videoId}" 
                            title="Latest Video" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    `;
                    videoEl.classList.remove('hidden');
                } else {
                    throw new Error(data.error || 'Failed to load video');
                }
            } catch (error) {
                console.error('Error loading video:', error);
                loadingEl.classList.add('hidden');
                errorEl.classList.remove('hidden');
            }
        }

        // Load blog posts
        async function loadBlogPosts() {
            const blogContainer = document.getElementById('blog-container');
            const blogTitle = document.getElementById('blog-title');

            try {
                const response = await fetch(`${API_BASE_URL}/api/blog-posts`);
                const data = await response.json();

                if (response.ok && data.posts && data.posts.length > 0) {
                    // Store posts globally for modal access
                    window.blogPosts = data.posts;
                    
                    // Update title
                    blogTitle.textContent = 'Latest Blog Posts';
                    
                    // Display first 3 blog posts
                    blogContainer.innerHTML = data.posts.slice(0, 3).map((post, index) => {
                        const publishDate = new Date(post.publish_date).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        
                        return `
                            <div class="bg-white rounded-xl shadow-md overflow-hidden card-hover cursor-pointer" onclick="openBlogPost(${index})">
                                <div class="p-6">
                                    <h3 class="text-xl font-semibold text-indigo-600 mb-3">${post.title}</h3>
                                    <p class="text-gray-700 mb-4 leading-relaxed">${post.excerpt}</p>
                                    <div class="flex justify-between items-center text-sm text-gray-500 mb-3">
                                        <span>By ${post.author}</span>
                                        <span>${publishDate}</span>
                                    </div>
                                    <div class="text-indigo-600 text-sm font-medium">Click to read more →</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    throw new Error('No blog posts found');
                }
            } catch (error) {
                console.error('Error loading blog posts:', error);
                blogTitle.textContent = 'Blog Posts';
                blogContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-600">Unable to load blog posts at this time.</p>
                        <p class="text-gray-500 text-sm mt-2">Please check back later.</p>
                    </div>
                `;
            }
        }

        // --- NEW & IMPROVED MODAL FUNCTIONS ---

        // Open blog post in modal
        function openBlogPost(index) {
            const post = window.blogPosts[index];
            if (!post) return;

            const publishDate = new Date(post.publish_date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 transition-opacity duration-300';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl transform scale-95 opacity-0 transition-all duration-300 ease-in-out">
                    <div class="p-6 border-b border-gray-200 flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">${post.title}</h2>
                            <div class="text-sm text-gray-500">By ${post.author} • ${publishDate}</div>
                        </div>
                        <button onclick="closeBlogModal()" class="text-gray-500 hover:text-gray-700 text-3xl ml-4 flex-shrink-0" aria-label="Close modal">&times;</button>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-[70vh]">
                        <div class="prose prose-lg max-w-none text-gray-900 leading-relaxed">
                            ${post.content}
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-gray-50 text-center">
                        <button onclick="closeBlogModal()" class="bg-indigo-600 text-white px-6 py-2 rounded-full hover:bg-indigo-700 transition duration-300 shadow-md">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';

            // Add smooth fade-in effect
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.querySelector('.transform').style.transform = 'scale(1)';
                modal.querySelector('.transform').style.opacity = '1';
            }, 10);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeBlogModal();
                }
            });
        }

        // Close blog modal
        function closeBlogModal() {
            const modal = document.querySelector('.fixed.inset-0.bg-black');
            if (modal) {
                const innerModal = modal.querySelector('.transform');
                innerModal.style.transform = 'scale(0.95)';
                innerModal.style.opacity = '0';
                modal.style.opacity = '0';

                setTimeout(() => {
                    modal.remove();
                    document.body.style.overflow = 'auto';
                }, 300); // Match this with your transition duration
            }
        }

        // --- END OF NEW & IMPROVED MODAL FUNCTIONS ---

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeBlogModal();
            }
        });

        // Handle contact form submission
        async function handleContactForm(event) {
            event.preventDefault();

            const form = document.getElementById('contact-form');
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const submitSpinner = document.getElementById('submit-spinner');

            const formData = new FormData(form);
            const data = {
                name: formData.get('name').trim(),
                email: formData.get('email').trim(),
                message: formData.get('message').trim()
            };

            if (!data.name || !data.email || !data.message) {
                showNotification('Please fill in all fields.', 'error');
                return;
            }

            submitBtn.disabled = true;
            submitText.classList.add('hidden');
            submitSpinner.classList.remove('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/contact`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification('Message sent successfully!', 'success');
                    form.reset();
                } else {
                    throw new Error(result.error || 'Failed to send message');
                }
            } catch (error) {
                console.error('Error sending message:', error);
                showNotification('Failed to send message. Please try again.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                submitSpinner.classList.add('hidden');
            }
        }

        // Smooth scrolling for navigation
        function initSmoothScrolling() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            loadLatestVideo();
            loadBlogPosts();
            document.getElementById('contact-form').addEventListener('submit', handleContactForm);
            initSmoothScrolling();
        });
    </script>
</body>
</html>
