<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shattered & Sent - Transformed by Grace, Empowered for Purpose</title>
    <meta name="description" content="Christian ministry sharing stories of redemption, healing, and God's grace. Biblical insights, testimonies, and practical wisdom for your spiritual journey.">
    <meta name="keywords" content="Christian ministry, faith, redemption, Bible study, testimonies, spiritual growth">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            /* Masculine-leaning color palette */
            --primary: #2A4D69; /* Dark Steel Blue */
            --primary-dark: #1E364A; /* Even Darker Steel Blue */
            --secondary: #4B8CC8; /* Medium Blue for accent */
            --accent: #F7B32B; /* Muted Gold/Amber for highlight */
            --text-primary: #2C3E50; /* Dark Charcoal */
            --text-secondary: #6E8898; /* Muted Gray-Blue */
            --background: #ECF0F1; /* Light Grey-Blue */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--background) 0%, #DCE3E8 100%); /* Subtle cool gradient */
            color: var(--text-primary);
            line-height: 1.7;
        }
        
        .heading-font {
            font-family: 'Oswald', sans-serif; /* Bolder, more condensed font for headings */
            font-weight: 700; /* Ensure headings are bold */
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 50%, var(--secondary) 100%); /* Darker, cooler gradient */
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(75, 140, 200, 0.3) 0%, transparent 50%), /* Using secondary color with opacity */
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(42, 77, 105, 0.2) 0%, transparent 50%); /* Using primary color with opacity */
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(1deg); }
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }
        
        .card-hover:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .content-card {
            background: linear-gradient(145deg, #ffffff 0%, #F5F7F9 100%); /* Slightly less bright background */
            border: 1px solid rgba(226, 232, 240, 0.8);
            position: relative;
            overflow: hidden;
            border-radius: 1rem; /* Less rounded corners for a firmer look */
        }
        
        .content-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(42, 77, 105, 0.1), transparent); /* Using new primary color with opacity */
            transition: left 0.5s ease;
        }
        
        .content-card:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px -5px rgba(42, 77, 105, 0.4); /* Shadow based on new primary */
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }
        
        .youtube-embed {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .youtube-embed iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .loading-spinner {
            border: 3px solid rgba(42, 77, 105, 0.2); /* Using new primary with opacity */
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .section-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, var(--primary) 50%, transparent 100%);
            margin: 3rem auto;
            max-width: 200px;
        }
        
        .stats-item {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .stats-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }
        
        .stats-number {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ffffff 0%, #F0F9FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }
        
        .image-overlay {
            position: relative;
            overflow: hidden;
            border-radius: 1rem; /* Less rounded corners for a firmer look */
        }
        
        .image-overlay img {
            transition: transform 0.5s ease;
        }
        
        .image-overlay:hover img {
            transform: scale(1.1);
        }
        
        .nav-link {
            position: relative;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 0;
            transition: color 0.3s ease;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--primary);
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        .form-input {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem; /* Slightly less rounded */
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(42, 77, 105, 0.1); /* Using new primary with opacity */
        }
        
        .section-padding {
            padding: 5rem 1.5rem;
        }
        
        @media (max-width: 768px) {
            .section-padding {
                padding: 3rem 1rem;
            }
            
            .hero-section {
                padding: 4rem 1rem;
            }
            
            .stats-number {
                font-size: 2rem;
            }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
        }

        /* New Modal Styling */
        .modal-overlay {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }
        .modal-overlay.is-visible {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content-wrapper {
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .modal-content-wrapper.is-active {
            transform: scale(1);
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Notification Container -->
    <div id="notification" class="notification">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span id="notification-text"></span>
        </div>
    </div>

    <!-- Header -->
    <header class="glass-effect sticky top-0 z-50 py-4 px-6">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center space-x-3 mb-4 md:mb-0">
                <!-- Updated logo source and added onerror fallback -->
                <img src="Shattered.png" 
                     alt="Shattered & Sent Logo" 
                     class="h-16 w-auto mr-3 rounded-lg shadow-md"
                     onerror="this.onerror=null;this.src='https://placehold.co/64x64/E0E0E0/888888?text=Logo';">
                <div>
                    <div class="text-2xl md:text-3xl font-bold gradient-text heading-font">Shattered & Sent</div>
                    <div class="text-sm text-gray-500 hidden md:block">From Brokenness to Bold Faith</div>
                </div>
            </div>
            <nav>
                <ul class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-8">
                    <li><a href="#home" class="nav-link">Home</a></li>
                    <li><a href="#about" class="nav-link">About</a></li>
                    <li><a href="#content" class="nav-link">Content</a></li>
                    <li><a href="#contact" class="nav-link">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero-section text-white section-padding relative">
        <div class="max-w-7xl mx-auto relative z-10">
            <div class="text-center max-w-5xl mx-auto">
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold heading-font leading-tight mb-8">
                    Transformed by Grace,
                    <span class="block text-yellow-300 mt-2">Empowered for Purpose</span>
                </h1>
                <p class="text-xl md:text-2xl mb-12 opacity-90 leading-relaxed max-w-4xl mx-auto">
                    From brokenness to bold faith — sharing stories of redemption, healing, and God's transformative grace. 
                    Discover biblical insights, powerful testimonies, and practical wisdom for your spiritual journey.
                </p>
                <div class="flex flex-col sm:flex-row gap-6 justify-center items-center mb-16">
                    <a href="#content" class="btn-primary text-lg">
                        <i class="fas fa-play-circle"></i>
                        Watch Latest Message
                    </a>
                    <a href="#about" class="btn-secondary text-lg">
                        <i class="fas fa-heart"></i>
                        Our Story
                    </a>
                </div>
                
                <!-- Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
                    <div class="stats-item">
                        <div class="stats-number">500+</div>
                        <p class="text-white/80 font-medium text-lg">Lives Transformed</p>
                    </div>
                    <div class="stats-item">
                        <div class="stats-number">100+</div>
                        <p class="text-white/80 font-medium text-lg">Video Messages</p>
                    </div>
                    <div class="stats-item">
                        <div class="stats-number">50+</div>
                        <p class="text-white/80 font-medium text-lg">Countries Reached</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Latest Video Section -->
    <section id="content" class="section-padding bg-white">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-bold gradient-text heading-font mb-6">Latest Message</h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    Watch our most recent inspiring message of hope, healing, and transformation
                </p>
                <div class="section-divider"></div>
            </div>
            
            <div id="youtube-container" class="max-w-5xl mx-auto">
                <div id="youtube-loading" class="flex justify-center items-center py-20 glass-effect rounded-3xl">
                    <div class="loading-spinner"></div>
                    <span class="ml-3 text-gray-600 text-lg">Loading latest message...</span>
                </div>
                <div id="youtube-video" class="youtube-embed hidden"></div>
                <div id="youtube-error" class="text-center py-16 glass-effect rounded-3xl hidden">
                    <i class="fas fa-exclamation-triangle text-orange-500 text-4xl mb-6"></i>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Unable to Load Video</h3>
                    <p class="text-gray-600 text-lg mb-4">We're having trouble loading the latest video right now.</p>
                    <a href="https://www.youtube.com/@shatteredsent" target="_blank" class="btn-primary">
                        <i class="fab fa-youtube mr-2"></i>
                        Visit Our YouTube Channel
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Study Guide Section -->
    <section class="section-padding relative" style="background-image: url('Shattered Thumbnail.jpg'); background-size: cover; background-position: center; background-attachment: fixed;">
        <!-- Overlay for readability -->
        <div class="absolute inset-0 bg-black opacity-50 z-0"></div>
        <div class="max-w-7xl mx-auto relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-bold heading-font mb-6 text-white">Featured Study Guide</h2>
                <p class="text-xl max-w-3xl mx-auto text-white">
                    Download our comprehensive curriculum for overcoming adversity through biblical wisdom
                </p>
                <div class="section-divider"></div>
            </div>
            
            <!-- Main Study Guide Card -->
            <div class="max-w-5xl mx-auto mb-16">
                <div class="content-card rounded-xl overflow-hidden card-hover bg-gradient-to-br from-white/90 to-blue-50/90">
                    <div class="grid lg:grid-cols-2 gap-0">
                        <div class="image-overlay rounded-xl">
                            <img src="https://placehold.co/600x400/D1D5DB/1F2937?text=Study+Guide+Image" 
                                 onerror="this.onerror=null;this.src='https://placehold.co/600x400/D1D5DB/1F2937?text=Image+Not+Found';"
                                 alt="Overcoming Adversity Study Guide" 
                                 class="w-full h-full object-cover min-h-[300px]">
                            <div class="absolute inset-0 bg-gradient-to-r from-primary-dark/80 to-primary/80 flex items-center justify-center">
                                <div class="text-center text-white p-8">
                                    <i class="fas fa-book-open text-6xl mb-4 opacity-90"></i>
                                    <h3 class="text-3xl font-bold heading-font">7-Session Study</h3>
                                    <p class="text-xl opacity-90">Downloadable PDF Guide</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-8 lg:p-12">
                            <div class="flex items-center mb-4">
                                <span class="bg-gradient-to-r from-accent to-yellow-600 text-white px-4 py-2 rounded-full text-sm font-semibold shadow-lg mr-4">New Release</span>
                                <span class="text-gray-500 text-sm">✨ Free Download</span>
                            </div>
                            <h3 class="text-3xl font-bold text-gray-800 heading-font mb-6">Overcoming Adversity</h3>
                            <p class="text-gray-600 mb-6 leading-relaxed text-lg">
                                A comprehensive 7-session curriculum designed to help believers move from brokenness to bold faith. Perfect for personal study, small groups, or church ministries.
                            </p>
                            
                            <!-- Study Guide Features -->
                            <div class="space-y-3 mb-8">
                                <div class="flex items-center text-gray-700">
                                    <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                    <span>7 in-depth sessions with Scripture foundations</span>
                                </div>
                                <div class="flex items-center text-gray-700">
                                    <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                    <span>Discussion questions for group study</span>
                                </div>
                                <div class="flex items-center text-gray-700">
                                    <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                    <span>Practical exercises and applications</span>
                                </div>
                                <div class="flex items-center text-gray-700">
                                    <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                    <span>Journaling prompts and reflection activities</span>
                                </div>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row gap-4">
                                <button onclick="openStudyGuideModal(event)" 
                                        onmousedown="console.log('Download button: Mouse Down');" 
                                        ontouchstart="console.log('Download button: Touch Start');" 
                                        ontouchend="console.log('Download button: Touch End');" 
                                        class="btn-primary text-lg flex-1">
                                    <i class="fas fa-download mr-2"></i>
                                    Download Free Guide
                                </button>
                                <button onclick="showStudyGuidePreview(event)" 
                                        onmousedown="console.log('Preview button: Mouse Down');" 
                                        ontouchstart="console.log('Preview button: Touch Start');" 
                                        ontouchend="console.log('Preview button: Touch End');" 
                                        class="btn-secondary bg-gray-100 text-gray-700 hover:bg-gray-200 border-gray-300 text-lg">
                                    <i class="fas fa-eye mr-2"></i>
                                    Preview
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Content Grid (Blog Posts) -->
    <section class="section-padding bg-gray-50">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-16">
                <h2 id="blog-title" class="text-4xl md:text-5xl font-bold gradient-text heading-font mb-6">More Resources</h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    Explore our collection of biblical insights, practical teachings, and inspiring testimonies
                </p>
                <div class="section-divider"></div>
            </div>
            
            <div id="blog-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Blog posts will be loaded here dynamically by JavaScript -->
                <!-- Placeholder cards for loading state -->
                <div class="content-card rounded-xl overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="animate-pulse">
                            <div class="h-4 bg-gray-300 rounded w-3/4 mb-3"></div>
                            <div class="h-3 bg-gray-300 rounded w-full mb-2"></div>
                            <div class="h-3 bg-gray-300 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
                <div class="content-card rounded-xl overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="animate-pulse">
                            <div class="h-4 bg-gray-300 rounded w-3/4 mb-3"></div>
                            <div class="h-3 bg-gray-300 rounded w-full mb-2"></div>
                            <div class="h-3 bg-gray-300 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
                <div class="content-card rounded-xl overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="animate-pulse">
                            <div class="h-4 bg-gray-300 rounded w-3/4 mb-3"></div>
                            <div class="h-3 bg-gray-300 rounded w-full mb-2"></div>
                            <div class="h-3 bg-gray-300 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section - Relocated for better flow -->
    <section id="about" class="section-padding bg-white">
        <div class="max-w-7xl mx-auto text-center">
            <h2 class="text-4xl md:text-5xl font-bold gradient-text heading-font mb-6">About Shattered & Sent</h2>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto mb-6 leading-relaxed">
                "Shattered & Sent" is a ministry dedicated to sharing the transformative power of God's love and grace. Even in brokenness, God uses us for His glorious purposes. We provide biblical insights, testimonies, and practical wisdom to encourage believers on their spiritual journey.
            </p>
            <div class="section-divider"></div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="section-padding bg-gradient-to-br from-background to-blue-50">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-bold gradient-text heading-font mb-6">Get in Touch</h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    We'd love to hear from you. Send us a message or connect via email.
                </p>
                <div class="section-divider"></div>
            </div>
            
            <div class="max-w-2xl mx-auto glass-effect p-8 rounded-xl shadow-lg">
                <form id="contact-form" class="space-y-6">
                    <div>
                        <label for="name" class="block text-lg font-medium text-gray-700 mb-2">Name</label>
                        <input type="text" id="name" name="name" required class="form-input" placeholder="Your Name">
                    </div>
                    <div>
                        <label for="email" class="block text-lg font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="email" name="email" required class="form-input" placeholder="you@example.com">
                    </div>
                    <div>
                        <label for="message" class="block text-lg font-medium text-gray-700 mb-2">Message</label>
                        <textarea id="message" name="message" rows="6" required class="form-input" placeholder="Your message..."></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" id="submit-btn" class="btn-primary text-lg px-10 py-4 shadow-xl disabled:opacity-50">
                            <span id="submit-text">Send Message</span>
                            <div id="submit-spinner" class="loading-spinner mx-auto hidden" style="width: 1.25rem; height: 1.25rem;"></div>
                        </button>
                    </div>
                </form>
                
                <div class="mt-12 text-center text-gray-600">
                    <p class="mb-2">Or email us directly at:</p>
                    <p class="text-xl font-semibold text-primary">
                        <a href="mailto:shattered.sent@gmail.com" class="hover:underline">shattered.sent@gmail.com</a>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 px-6 md:px-12 text-center">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-8 mb-6">
                <a href="https://www.youtube.com/@shatteredsent" target="_blank" class="text-white/80 hover:text-white transition duration-300">
                    <i class="fab fa-youtube text-2xl"></i>
                </a>
                <a href="mailto:shattered.sent@gmail.com" class="text-white/80 hover:text-white transition duration-300">
                    <i class="fas fa-envelope text-2xl"></i>
                </a>
                <!-- Add other social media links as needed -->
            </div>
            <p class="text-gray-400 text-sm">&copy; 2025 Shattered & Sent. All rights reserved.</p>
        </div>
    </footer>

    <!-- Study Guide Download Modal -->
    <div id="study-guide-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-[60] flex items-center justify-center p-4 modal-overlay">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-hidden shadow-2xl modal-content-wrapper">
            <div class="p-6 border-b border-gray-200 flex justify-between items-start">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Download Study Guide</h2>
                    <p class="text-gray-600">Fill in your details to get your free guide.</p>
                </div>
                <button onclick="closeStudyGuideModal()" class="text-gray-500 hover:text-gray-700 text-3xl ml-4 flex-shrink-0" aria-label="Close modal">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]">
                <form id="download-form" class="space-y-6">
                    <div>
                        <label for="download-name" class="block text-lg font-medium text-gray-700 mb-2">Name</label>
                        <input type="text" id="download-name" name="name" required class="form-input" placeholder="Your Name">
                    </div>
                    <div>
                        <label for="download-email" class="block text-lg font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="download-email" name="email" required class="form-input" placeholder="your.email@example.com">
                    </div>
                    <div>
                        <label for="intended_use" class="block text-lg font-medium text-gray-700 mb-2">How do you intend to use this guide?</label>
                        <select id="intended_use" name="intended_use" class="form-input">
                            <option value="personal">Personal Study</option>
                            <option value="small_group">Small Group</option>
                            <option value="church_ministry">Church Ministry</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="newsletter" name="newsletter" class="h-5 w-5 text-primary focus:ring-primary border-gray-300 rounded">
                        <label for="newsletter" class="ml-2 block text-gray-700">Subscribe to our newsletter for more resources and updates.</label>
                    </div>
                    <div class="text-center">
                        <button type="button" onclick="downloadStudyGuide()" class="btn-primary text-lg px-10 py-4 shadow-xl">
                            Download Now
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Study Guide Preview Modal -->
    <div id="preview-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-[60] flex items-center justify-center p-4 modal-overlay">
        <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl modal-content-wrapper">
            <div class="p-6 border-b border-gray-200 flex justify-between items-start">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Study Guide Preview</h2>
                    <p class="text-gray-600">A glimpse into the "Overcoming Adversity" curriculum.</p>
                </div>
                <button onclick="closePreviewModal()" class="text-gray-500 hover:text-gray-700 text-3xl ml-4 flex-shrink-0" aria-label="Close preview">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]">
                <div id="preview-content" class="prose prose-lg max-w-none text-gray-900 leading-relaxed">
                    <!-- Study guide content will be loaded here -->
                </div>
            </div>
            <div class="p-6 border-t border-gray-200 bg-gray-50 text-center">
                <button onclick="closePreviewModal()" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-primary-dark transition duration-300 shadow-md">
                    Close Preview
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Update this to match your deployed backend URL
        const API_BASE_URL = 'https://jshafer2017.pythonanywhere.com';

        // Show notifications
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            const notificationIcon = notification.querySelector('i');

            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            if (type === 'success') {
                notificationIcon.className = 'fas fa-check-circle mr-2';
            } else if (type === 'error') {
                notificationIcon.className = 'fas fa-times-circle mr-2';
            }

            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Load latest YouTube video
        async function loadLatestVideo() {
            const loadingEl = document.getElementById('youtube-loading');
            const videoEl = document.getElementById('youtube-video');
            const errorEl = document.getElementById('youtube-error');

            try {
                const response = await fetch(`${API_BASE_URL}/api/latest-video`);
                const data = await response.json();

                if (response.ok && data.videoId) {
                    loadingEl.classList.add('hidden');
                    videoEl.innerHTML = `
                        <iframe 
                            src="https://www.youtube.com/embed/${data.videoId}" 
                            title="Latest Video" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    `;
                    videoEl.classList.remove('hidden');
                } else {
                    throw new Error(data.error || 'Failed to load video');
                }
            } catch (error) {
                console.error('Error loading video:', error);
                loadingEl.classList.add('hidden');
                errorEl.classList.remove('hidden');
            }
        }

        // Load blog posts
        async function loadBlogPosts() {
            const blogContainer = document.getElementById('blog-container');
            const blogTitle = document.getElementById('blog-title'); 
            
            console.log('Value of blogTitle element:', blogTitle); // Added for debugging
            console.log('Attempting to load blog posts from:', `${API_BASE_URL}/api/blog-posts`);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/blog-posts`);
                console.log('Response status:', response.status, 'Response OK:', response.ok);
                
                const data = await response.json();
                console.log('Data received:', data);

                if (response.ok && data.posts && data.posts.length > 0) {
                    // Store posts globally for modal access
                    window.blogPosts = data.posts;
                    
                    // Update title (if blogTitle element exists)
                    if (blogTitle) {
                        blogTitle.textContent = 'Latest Blog Posts';
                    }
                    
                    // Display first 3 blog posts
                    blogContainer.innerHTML = data.posts.slice(0, 3).map((post, index) => {
                        const publishDate = new Date(post.publish_date).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        
                        return `
                            <div class="bg-white rounded-xl shadow-md overflow-hidden card-hover cursor-pointer" 
                                 onclick="openBlogPost(${index})"
                                 onmousedown="console.log('Blog card ${index}: Mouse Down');" 
                                 ontouchstart="console.log('Blog card ${index}: Touch Start');" 
                                 ontouchend="console.log('Blog card ${index}: Touch End');">
                                <div class="p-6">
                                    <h3 class="text-xl font-semibold text-indigo-600 mb-3">${post.title}</h3>
                                    <p class="text-gray-700 mb-4 leading-relaxed">${post.excerpt}</p>
                                    <div class="flex justify-between items-center text-sm text-gray-500 mb-3">
                                        <span>By ${post.author}</span>
                                        <span>${publishDate}</span>
                                    </div>
                                    <div class="text-indigo-600 text-sm font-medium">Click to read more →</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    console.warn('API returned no posts or an error:', data);
                    // More robust error display if blogTitle is null (though the check above should handle this)
                    if (blogTitle) {
                        blogTitle.textContent = 'Blog Posts'; 
                    }
                    blogContainer.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <p class="text-gray-600">Unable to load blog posts at this time.</p>
                            <p class="text-gray-500 text-sm mt-2">Please check back later.</p>
                            <p class="text-red-500 text-sm mt-1">Error: ${data.error || 'No posts or API error.'}</p>
                        </div>
                    `;
                    throw new Error(data.error || 'No blog posts found or API error.');
                }
            } catch (error) {
                console.error('Error loading blog posts:', error);
                // Ensure blogTitle is handled even if it somehow becomes null after the initial check
                if (blogTitle) {
                    blogTitle.textContent = 'Blog Posts'; 
                }
                blogContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-600">Unable to load blog posts at this time.</p>
                        <p class="text-gray-500 text-sm mt-2">Please check back later.</p>
                        <p class="text-red-500 text-sm mt-1">Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Open blog post in modal
        function openBlogPost(index) {
            const post = window.blogPosts[index];
            if (!post) return;

            const publishDate = new Date(post.publish_date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const modal = document.createElement('div');
            // Using `modal-overlay` class for the outer div
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4 modal-overlay hidden'; 
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl modal-content-wrapper">
                    <div class="p-6 border-b border-gray-200 flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">${post.title}</h2>
                            <div class="text-sm text-gray-500">By ${post.author} • ${publishDate}</div>
                        </div>
                        <button onclick="closeBlogModal()" class="text-gray-500 hover:text-gray-700 text-3xl ml-4 flex-shrink-0" aria-label="Close modal">&times;</button>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-[70vh]">
                        <div class="prose prose-lg max-w-none text-gray-900 leading-relaxed">
                            ${post.content}
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-gray-50 text-center">
                        <button onclick="closeBlogModal()" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-primary-dark transition duration-300 shadow-md">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';

            // Add smooth fade-in effect using new classes
            setTimeout(() => {
                modal.classList.remove('hidden'); // Ensure it's not hidden before applying visibility
                modal.classList.add('is-visible');
                modal.querySelector('.modal-content-wrapper').classList.add('is-active');
            }, 10);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeBlogModal();
                }
            });
        }

        // Close blog modal
        function closeBlogModal() {
            const modal = document.querySelector('.fixed.inset-0.bg-black.modal-overlay');
            if (modal) {
                const innerModal = modal.querySelector('.modal-content-wrapper');
                
                modal.classList.remove('is-visible');
                innerModal.classList.remove('is-active');

                setTimeout(() => {
                    modal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }, 300); // Match this with your transition duration
            }
        }

        // Study Guide Modal Functions
        function openStudyGuideModal(event) {
            if (event) event.stopPropagation();
            const modal = document.getElementById('study-guide-modal');
            const innerModal = modal.querySelector('.modal-content-wrapper');

            modal.classList.remove('hidden'); // Ensure it's not hidden before applying visibility
            document.body.style.overflow = 'hidden';

            setTimeout(() => {
                modal.classList.add('is-visible');
                innerModal.classList.add('is-active');
            }, 10);
        }

        function closeStudyGuideModal() {
            const modal = document.getElementById('study-guide-modal');
            if (modal) {
                const innerModal = modal.querySelector('.modal-content-wrapper');
                
                modal.classList.remove('is-visible');
                innerModal.classList.remove('is-active');

                setTimeout(() => {
                    modal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }, 300);
            }
        }

        function showStudyGuidePreview(event) {
            if (event) event.stopPropagation();

            const previewContentEl = document.getElementById('preview-content');
            previewContentEl.innerHTML = generateStudyGuideContentForPreview(); 

            const modal = document.getElementById('preview-modal');
            const innerModal = modal.querySelector('.modal-content-wrapper');

            modal.classList.remove('hidden'); // Ensure it's not hidden before applying visibility
            document.body.style.overflow = 'hidden';

            setTimeout(() => {
                modal.classList.add('is-visible');
                innerModal.classList.add('is-active');
            }, 10);
        }

        function closePreviewModal() {
            const modal = document.getElementById('preview-modal');
            if (modal) {
                const innerModal = modal.querySelector('.modal-content-wrapper');
                
                modal.classList.remove('is-visible');
                innerModal.classList.remove('is-active');

                setTimeout(() => {
                    modal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }, 300);
            }
        }

        // Handle study guide download
        async function downloadStudyGuide() {
            const form = document.getElementById('download-form');
            const downloadNameInput = document.getElementById('download-name');
            const downloadEmailInput = document.getElementById('download-email');

            const data = {
                name: downloadNameInput.value.trim(),
                email: downloadEmailInput.value.trim(),
                intended_use: form.elements['intended_use'].value || 'not specified',
                newsletter: form.elements['newsletter'].checked
            };

            // Basic validation
            if (!data.name || !data.email) {
                showNotification('Please fill in your name and email address.', 'error');
                return;
            }

            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(data.email)) {
                showNotification('Please enter a valid email address.', 'error');
                return;
            }

            try {
                showNotification('Preparing your download...', 'success');
                
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Generate and download the PDF
                generateStudyGuidePDF(data.name);
                
                // Close modal
                closeStudyGuideModal();
                
                // Show success message
                showNotification('Study guide downloaded successfully! Check your downloads folder.', 'success');
                
                // Clear form
                form.reset();
                
            } catch (error) {
                console.error('Error downloading study guide:', error);
                showNotification('Failed to download study guide. Please try again.', 'error');
            }
        }

        // Function to generate the study guide content for both download and preview
        function generateStudyGuideContentForPreview() {
            const userName = document.getElementById('download-name')?.value || 'Guest'; // Use name from form if available, else 'Guest'

            return `
                <div class="text-center mb-8">
                    <img src="Shattered Thumbnail.jpg" alt="Shattered & Sent Study Guide Cover" class="w-full max-w-sm mx-auto rounded-lg shadow-lg mb-6" onerror="this.onerror=null;this.src='https://placehold.co/400x250/D1D5DB/1F2937?text=Study+Guide';">
                </div>
                <h1 class="text-3xl font-bold mb-4">Overcoming Adversity: A 7-Session Study Guide</h1>
                <h2 class="text-xl font-semibold mb-6">Shattered & Sent Ministry</h2>

                <p class="mb-2"><em>Downloaded by: ${userName}</em></p>
                <p class="mb-6"><em>Date: ${new Date().toLocaleDateString()}</em></p>

                <hr class="my-8 border-gray-300">

                <h2 class="text-2xl font-bold mb-3">Session 1: Understanding Adversity — God's Classroom for Growth</h2>
                <p class="font-semibold text-lg mb-2">Scripture Foundation: Romans 5:3–5; James 1:2–4</p>
                <p class="font-semibold text-lg mb-4">Key Teaching: Adversity is not meaningless—it is a classroom where God develops perseverance, character, and hope.</p>

                <h3 class="text-xl font-semibold mb-2">Teaching Points:</h3>
                <ol class="list-decimal list-inside ml-4 space-y-1">
                    <li>Adversity comes in many forms (loss, sin, failure, injustice, hardship).</li>
                    <li>God does not waste suffering; He uses it to shape us into Christlikeness.</li>
                    <li>Trials invite us to trust God more deeply.</li>
                </ol>

                <h3 class="text-xl font-semibold mt-6 mb-2">Discussion Questions:</h3>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>When you face adversity, what is your first reaction?</li>
                    <li>How have past trials shaped your faith?</li>
                    <li>What do you think it means that suffering produces hope?</li>
                </ul>

                <p class="font-semibold italic mt-6">Application Challenge: Journal one trial you are currently experiencing. Write down what God may be teaching you through it.</p>

                <hr class="my-8 border-gray-300">

                <h2 class="text-2xl font-bold mb-3">Session 2: Cultivating a Growth Mindset Rooted in God's Promises</h2>
                <p class="font-semibold text-lg mb-2">Scripture Foundation: Philippians 4:8; Hebrews 13:5</p>
                <p class="font-semibold text-lg mb-4">Key Teaching: Faith reframes challenges, turning obstacles into opportunities for growth.</p>

                <h3 class="text-xl font-semibold mb-2">Teaching Points:</h3>
                <ol class="list-decimal list-inside ml-4 space-y-1">
                    <li>A growth mindset believes hardship is an opportunity to mature.</li>
                    <li>God's promises remind us we are not abandoned in adversity.</li>
                    <li>Replacing negative self-talk with biblical truth renews our minds.</li>
                </ol>

                <h3 class="text-xl font-semibold mt-6 mb-2">Discussion Questions:</h3>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>What lies do you tend to believe in hardship?</li>
                    <li>What promises from Scripture combat those lies?</li>
                    <li>How does focusing on "whatever is true, noble, right, pure" (Philippians 4:8) change perspective?</li>
                </ul>

                <p class="font-semibold italic mt-6">Practical Exercise: Write down one negative thought you often struggle with. Next to it, write the scriptural truth that replaces it.</p>

                <hr class="my-8 border-gray-300">

                <h2 class="text-2xl font-bold mb-3">Session 3: Building Resilience Through Daily Habits</h2>
                <p class="font-semibold text-lg mb-2">Scripture Foundation: 1 Thessalonians 5:16–18; Psalm 46:1</p>
                <p class="font-semibold text-lg mb-4">Key Teaching: Resilience isn't built overnight—it's developed through faithful, daily practices rooted in God.</p>

                <h3 class="text-xl font-semibold mb-2">Teaching Points:</h3>
                <ol class="list-decimal list-inside ml-4 space-y-1">
                    <li>Small, consistent steps forward build strength.</li>
                    <li>Daily disciplines of prayer, Scripture reading, and worship anchor us.</li>
                    <li>God is our refuge and strength in chaos.</li>
                </ol>

                <h3 class="text-xl font-semibold mt-6 mb-2">Discussion Questions:</h3>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>What daily habits keep you grounded in your faith?</li>
                    <li>How does prayer or worship help you in difficult seasons?</li>
                    <li>What habit can you begin this week to build resilience?</li>
                </ul>

                <p class="font-semibold italic mt-6">Application Challenge: Create a "Resilience Routine"—a short daily plan (5–10 minutes) of prayer, Scripture, and gratitude.</p>

                <hr class="my-8 border-gray-300">

                <h2 class="text-2xl font-bold mb-3">Session 4: Leaning Into Community & Biblical Support Networks</h2>
                <p class="font-semibold text-lg mb-2">Scripture Foundation: Galatians 6:2; Hebrews 10:24–25</p>
                <p class="font-semibold text-lg mb-4">Key Teaching: God designed us to carry each other's burdens and to encourage one another.</p>

                <h3 class="text-xl font-semibold mb-2">Teaching Points:</h3>
                <ol class="list-decimal list-inside ml-4 space-y-1">
                    <li>Resilience grows in community, not isolation.</li>
                    <li>Sharing struggles invites empathy and prayer.</li>
                    <li>Encouragement is a vital tool for overcoming hardship.</li>
                </ol>

                <h3 class="text-xl font-semibold mt-6 mb-2">Discussion Questions:</h3>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Who in your life encourages you when you're struggling?</li>
                    <li>Why is it difficult to be vulnerable about adversity?</li>
                    <li>How can you be an encourager for others?</li>
                </ul>

                <p class="font-semibold italic mt-6">Group Activity: Pair up and share one struggle you're facing. Pray for each other using a specific Scripture promise.</p>

                <hr class="my-8 border-gray-300">

                <h2 class="text-2xl font-bold mb-3">Session 5: Finding Silver Linings in Hardship</h2>
                <p class="font-semibold text-lg mb-2">Scripture Foundation: 2 Corinthians 12:9–10; Genesis 50:20</p>
                <p class="font-semibold text-lg mb-4">Key Teaching: Even in pain, God brings beauty, strength, and purpose.</p>

                <h3 class="text-xl font-semibold mb-2">Teaching Points:</h3>
                <ol class="list-decimal list-inside ml-4 space-y-1">
                    <li>Hardship develops compassion, humility, and empathy.</li>
                    <li>God's power is made perfect in weakness.</li>
                    <li>What others meant for harm, God can turn to good.</li>
                </ol>

                <h3 class="text-xl font-semibold mt-6 mb-2">Discussion Questions:</h3>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>What is one way a past hardship has shaped you for the better?</li>
                    <li>How does Paul's statement "when I am weak, then I am strong" speak to your own life?</li>
                    <li>Can you identify a silver lining in your current struggle?</li>
                </ul>

                <p class="font-semibold italic mt-6">Practical Exercise: Write a short testimony of how God brought good out of a past adversity. Share it with a trusted friend or group.</p>

                <hr class="my-8 border-gray-300">

                <h2 class="text-2xl font-bold mb-3">Session 6: Standing Firm With Hope & Perseverance</h2>
                <p class="font-semibold text-lg mb-2">Scripture Foundation: Isaiah 40:31; Hebrews 12:1–2</p>
                <p class="font-semibold text-lg mb-4">Key Teaching: Hope sustains us in adversity, and perseverance strengthens our faith for the long journey.</p>

                <h3 class="text-xl font-semibold mb-2">Teaching Points:</h3>
                <ol class="list-decimal list-inside ml-4 space-y-1">
                    <li>Hope is not wishful thinking—it's confidence in God's promises.</li>
                    <li>The Christian life is a marathon, not a sprint.</li>
                    <li>Fixing our eyes on Jesus sustains us through trials.</li>
                </ol>

                <h3 class="text-xl font-semibold mt-6 mb-2">Discussion Questions:</h3>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>What gives you hope in your darkest seasons?</li>
                    <li>What does it mean to "run with perseverance the race marked out for us"?</li>
                    <li>How can you keep your focus on Jesus amid adversity?</li>
                </ul>

                <p class="font-semibold italic mt-6">Journaling Prompt: Write a compassionate pep talk to yourself. Encourage yourself with Scripture and remind yourself of God's faithfulness.</p>

                <hr class="my-8 border-gray-300">

                <h2 class="text-2xl font-bold mb-3">Session 7: Reflection, Renewal, & Testimony</h2>
                <p class="font-semibold text-lg mb-2">Scripture Foundation: Lamentations 3:21–23; Psalm 77:11–12</p>
                <p class="font-semibold text-lg mb-4">Key Teaching: Reflection helps us recognize God's faithfulness and strengthens us for the future.</p>

                <h3 class="text-xl font-semibold mb-2">Teaching Points:</h3>
                <ol class="list-decimal list-inside ml-4 space-y-1">
                    <li>Journaling and prayer bring clarity and healing.</li>
                    <li>Remembering past victories fuels future resilience.</li>
                    <li>Testimonies encourage both ourselves and others.</li>
                </ol>

                <h3 class="text-xl font-semibold mt-6 mb-2">Discussion Questions:</h3>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>How has God shown Himself faithful in your past?</li>
                    <li>Why is it important to remember and record His works?</li>
                    <li>How can your story encourage others in their adversity?</li>
                </ul>

                <p class="font-semibold italic mt-6">Final Activity: Write your "Adversity Testimony"—a brief summary of one hardship, how God carried you, and what you learned. Share it with your group or publish it as encouragement for others.</p>

                <hr class="my-8 border-gray-300">

                <p class="font-bold mt-8 text-center text-lg">This study guide is a gift from Shattered & Sent Ministry.</p>
                <p class="text-center">For more resources, visit us online or contact us at shattered.sent@gmail.com</p>
                <p class="text-center font-bold italic mt-4">"We know that in all things God works for the good of those who love him, who have been called according to his purpose." - Romans 8:28</p>
            `;
        }

        // Generate PDF function (simplified version)
        function generateStudyGuidePDF(userName) {
            const studyGuideContent = generateStudyGuideContentForPreview(); // Reuse content from preview

            // Create and download the file
            const blob = new Blob([studyGuideContent], { type: 'text/html;charset=utf-8' }); // Changed to text/html
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'Overcoming-Adversity-Study-Guide-Shattered-and-Sent.html'; // Changed to .html
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            const studyModal = document.getElementById('study-guide-modal');
            const previewModal = document.getElementById('preview-modal');
            
            // Close study guide modal if visible and click is outside its content
            if (studyModal && !studyModal.classList.contains('hidden') && !studyModal.querySelector('.modal-content-wrapper').contains(event.target)) {
                closeStudyGuideModal();
            }
            // Close preview modal if visible and click is outside its content
            if (previewModal && !previewModal.classList.contains('hidden') && !previewModal.querySelector('.modal-content-wrapper').contains(event.target)) {
                closePreviewModal();
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeStudyGuideModal();
                closePreviewModal();
            }
        });

        // Handle contact form submission
        async function handleContactForm(event) {
            event.preventDefault();

            const form = document.getElementById('contact-form');
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const submitSpinner = document.getElementById('submit-spinner');

            const formData = new FormData(form);
            const data = {
                name: formData.get('name').trim(),
                email: formData.get('email').trim(),
                message: formData.get('message').trim()
            };

            if (!data.name || !data.email || !data.message) {
                showNotification('Please fill in all fields.', 'error');
                return;
            }

            submitBtn.disabled = true;
            submitText.classList.add('hidden');
            submitSpinner.classList.remove('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/contact`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showNotification('Message sent successfully!', 'success');
                    form.reset();
                } else {
                    throw new Error(result.error || 'Failed to send message');
                }
            } catch (error) {
                console.error('Error sending message:', error);
                showNotification('Failed to send message. Please try again.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                submitSpinner.classList.add('hidden');
            }
        }

        // Smooth scrolling for navigation
        function initSmoothScrolling() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            loadLatestVideo();
            loadBlogPosts();
            document.getElementById('contact-form').addEventListener('submit', handleContactForm);
            initSmoothScrolling();
        });
    </script>
</body>
</html>
